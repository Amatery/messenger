(this.webpackJsonpmessenger=this.webpackJsonpmessenger||[]).push([[0],{131:function(e,t,n){e.exports=n(201)},136:function(e,t,n){},171:function(e,t){},174:function(e,t,n){},201:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(7),s=n.n(r);n(136),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o=n(31),i=n(42),l=n(89),u=n(51),m=n(123),d=n.n(m),g={socket:null,createConnection:function(){this.socket=d()("https://sin-messenger.herokuapp.com/")},subscribe:function(e,t,n){var a,c,r;null===(a=this.socket)||void 0===a||a.on("init-messages-published",e),null===(c=this.socket)||void 0===c||c.on("new-message-sent",t),null===(r=this.socket)||void 0===r||r.on("user-typing",n)},destroyConnection:function(){var e;null===(e=this.socket)||void 0===e||e.disconnect(),this.socket=null},sendName:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-name-sent",e,(function(e){console.log(e),e&&alert(e)}))},sendMessage:function(e){var t;null===(t=this.socket)||void 0===t||t.emit("client-message-sent",e,(function(e){e&&alert(e)}))},typeMessage:function(){var e;null===(e=this.socket)||void 0===e||e.emit("client-typed")}},h={messages:[],typingUsers:[]},f=function(e){return{type:"chat/messages-received",messages:e}},v=function(e){return{type:"chat/new-message-received",message:e}},b=function(e){return{type:"chat/typingUserAdded",user:e}},p=function(e){return{type:"chat/typingUserDeleted",user:e}},y=0,E=function(e){return function(t){g.sendMessage(e)}},O=n(124),j=Object(i.c)({chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"chat/messages-received":return Object(u.a)({},e,{messages:t.messages});case"chat/new-message-received":return Object(u.a)({},e,{messages:[].concat(Object(l.a)(e.messages),[t.message]),typingUsers:e.typingUsers.filter((function(e){return e.id!==t.message.user.id}))});case"chat/typingUserAdded":return Object(u.a)({},e,{typingUsers:[].concat(Object(l.a)(e.typingUsers.filter((function(e){return e.id!==t.user.id}))),[t.user])});case"chat/typingUserDeleted":return Object(u.a)({},e,{typingUsers:e.typingUsers.filter((function(e){return e.id!==t.user.id}))});default:return e}}}),N=Object(i.d)(j,Object(i.a)(O.a));window.store=N;var _=n(35),k=n(10),w=(n(174),n(44)),T=n.n(w),C=n(69),U=n.n(C),x=n(67),B=n.n(x),M=n(125),S=n.n(M),F=function(e){var t=Object(o.c)((function(e){return e.chat.messages})),n=Object(o.c)((function(e){return e.chat.typingUsers})),r=Object(o.b)(),s=Object(a.useState)(""),i=Object(_.a)(s,2),l=i[0],u=i[1],m=Object(a.useState)(!0),d=Object(_.a)(m,2),h=d[0],f=d[1],v=Object(a.useState)(0),b=Object(_.a)(v,2),p=b[0],y=b[1];Object(a.useEffect)((function(){var e;h&&(null===(e=O.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[t,n]),Object(a.useEffect)((function(){return function(){r((function(e){g.destroyConnection()}))}}),[]);var O=Object(a.useRef)(null),j=t.map((function(e){return c.a.createElement("div",{key:e.id},c.a.createElement("div",{className:T.a.chatName},c.a.createElement(S.a,{className:T.a.chatAvatar}),c.a.createElement("div",null,c.a.createElement("b",null,e.user.name,": "),e.message)),c.a.createElement("hr",null))})),N=n.map((function(e){return c.a.createElement("div",{key:e.id},c.a.createElement("b",null,e.name,":")," ...")}));return"anonymous"===e.name?c.a.createElement(k.a,{to:"/login"}):c.a.createElement("div",null,c.a.createElement("div",{className:T.a.chatWindow,onScroll:function(e){var t=e.currentTarget,n=t.scrollHeight-t.clientHeight;t.scrollTop>p&&Math.abs(n-t.scrollTop)<2?f(!0):f(!1),y(t.scrollTop)}},j,N,c.a.createElement("div",{ref:O})),c.a.createElement("div",{className:T.a.messageField},c.a.createElement(B.a,{id:"outlined-basic",label:"Enter your message...",value:l,onKeyPress:function(e){"Enter"===e.key&&(r(E(l)),u(""))},onChange:function(e){u(e.currentTarget.value),r((function(e){g.typeMessage()}))}})),c.a.createElement("div",{className:T.a.messageButton},c.a.createElement(U.a,{size:"medium",variant:"outlined",color:"primary",onClick:function(){r(E(l)),u("")}},"Send message")))},A=n(45),P=n.n(A),W=n(39),I=function(e){var t=Object(o.b)(),n=Object(k.g)(),r=function(){var n;e.setName(e.temporaryName),t((n=e.temporaryName,function(e){g.sendName(n)}))};return Object(a.useEffect)((function(){t((function(e){g.createConnection(),g.subscribe((function(t,n){e(f(t)),n("data from front")}),(function(t){e(v(t))}),(function(t){e(b(t)),clearTimeout(y),y=window.setTimeout((function(){e(p(t))}),5e3)}))}))}),[]),c.a.createElement("div",null,c.a.createElement("h1",{className:P.a.header},"Welcome to chat"),c.a.createElement("div",{className:P.a.nameField},c.a.createElement(B.a,{id:"outlined-basic",label:"Enter your name",onChange:function(t){return e.setTemporaryName(t.currentTarget.value)},onKeyPress:function(t){"Enter"===t.key&&e.temporaryName.length>0&&(r(),n.push("/chat"))}})),c.a.createElement("div",{className:P.a.nameButton},c.a.createElement(W.b,{className:P.a.buttonText,to:e.temporaryName.length<1?"/login":"/chat"},c.a.createElement(U.a,{className:P.a.buttonText,size:"medium",variant:"outlined",color:"primary",disabled:e.temporaryName.length<1,onClick:r},"Enter to chat"))))},K=function(){var e=Object(a.useState)(""),t=Object(_.a)(e,2),n=t[0],r=t[1],s=Object(a.useState)("anonymous"),o=Object(_.a)(s,2),i=o[0],l=o[1];return c.a.createElement("div",{className:"App"},c.a.createElement(k.d,null,c.a.createElement(k.b,{exact:!0,path:"/",render:function(){return c.a.createElement(k.a,{to:"/login"})}}),c.a.createElement(k.b,{path:"/login",render:function(){return c.a.createElement(I,{temporaryName:n,setTemporaryName:r,name:i,setName:l})}}),c.a.createElement(k.b,{path:"/chat",render:function(){return c.a.createElement(F,{name:i})}})))};s.a.render(c.a.createElement(W.a,null,c.a.createElement(c.a.StrictMode,null,c.a.createElement(o.a,{store:N},c.a.createElement(K,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},44:function(e,t,n){e.exports={chatWindow:"Chat_chatWindow__35nOg",messageField:"Chat_messageField__2XZhh",messageButton:"Chat_messageButton__14qt4",header:"Chat_header__eIfgM",chatName:"Chat_chatName__PyRIk",chatAvatar:"Chat_chatAvatar__10KIl"}},45:function(e,t,n){e.exports={nameField:"LoginPage_nameField__2TzQ3",nameButton:"LoginPage_nameButton__1lNK0",buttonText:"LoginPage_buttonText__1FdEM"}}},[[131,1,2]]]);
//# sourceMappingURL=main.c2ec3cde.chunk.js.map